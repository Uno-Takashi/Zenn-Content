---
title: "Pythonãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’CIã«çµ„ã¿è¾¼ã¿ãŸã„[pip-licenses , GitHub Actions]"
emoji: "ðŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["python","poetry","pip","GitHubActions","CI"]
published: false
---

## ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ãƒ”ãƒƒãƒ

- CIã®ä¸€ç’°ã¨ã—ã¦ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‹ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«å…¥ã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
  - ä»Šã¾ã§ç„¡ã‹ã£ãŸãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚„å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’æ¤œçŸ¥
- GitHub Actionsã¨ã—ã¦å®Ÿè¡Œ
- ç„¡èª²é‡‘ã§å®Ÿæ–½å¯èƒ½

## æ¦‚è¦

Pythonã®å¼·ã¿ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å……å®Ÿï¼ï¼â€¦â€¦ã§ã‚ã‚‹ãŒã‚†ãˆã«ã€èª°ã‚‚ãŒã¤ã„ã¤ã„è€ƒãˆãªã—ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ç¢ºèªã›ãšã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«çµ„ã¿è¾¼ã‚“ã§ã—ã¾ã†çµŒé¨“ãŒã‚ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã—ã‹ã—å½“ç„¶ãªãŒã‚‰ã€ç§é”é–‹ç™ºè€…ã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®èªã‚ã‚‹ç¯„ç–‡ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãªãã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚

ç‰¹ã«ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹éš›ã«ã¯ç´°å¿ƒã®æ³¨æ„ã‚’æ‰•ã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

ã—ã‹ã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ãƒªãƒªãƒ¼ã‚¹æ™‚ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ã‚¢éƒ¨åˆ†ã«ã„ã¤ã®é–“ã«ã€å—ã‘å…¥ã‚ŒãŒãŸã„æ¡é …ã‚’å«ã‚“ã ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ãŸå ´åˆã€ãã®å¯¾å¿œãŒè¾›ã„ã“ã¨ã«ãªã‚‹ã®ã¯ç«ã‚’è¦‹ã‚‹ã‚ˆã‚Šã‚‚æ˜Žã‚‰ã‹ã§ã™ã€‚å ´åˆã«ã‚ˆã£ã¦ã¯è£½å“ã‚’å…¬é–‹å‡ºæ¥ãªããªã‚‹ãƒªã‚¹ã‚¯ã™ã‚‰ç™ºç”Ÿã—ã¾ã™ã€‚

ãã†ã—ãŸçŠ¶æ³ã‚’å›žé¿ã™ã‚‹ãŸã‚ã«ã¯ã€å¸¸æ—¥é ƒã‹ã‚‰æ–°ãŸã«è¿½åŠ ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ç›£è¦–ã—ç¶šã‘ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

â€¦â€¦ã¾ãå£ã§è¨€ã†ã®ã¯ç°¡å˜ã§ã™ã‚ˆã­ã€‚å®Ÿéš›ã¯ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãã®ã¯ãã‚Œãªã‚Šã«ã—ã‚“ã©ã„&ã‚ã‚“ã©ãã•ã„ä½œæ¥­ã§ã™ã€‚æ­£ç›´ç§ã¯ç¶šã‘ã¦ã„ã‘ã‚‹è‡ªä¿¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã“ã§ä»Šå›žã¯ã€`pip-licenses`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯ä½œæ¥­ã®ä¸€éƒ¨ã‚’è‡ªå‹•åŒ–ã—GitHub Actionsã®CIã«çµ„ã¿è¾¼ã‚€æ–¹æ³•ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚

## `pip-licenses`ã®ä½¿ã„æ–¹

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

poetryã‚„pipãªã©å¤šãã®ç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã²ã¨ã¾ãšã€pipã¨poetryã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

```shell
pip install pip-licenses
```

```shell
poetry add pip-licenses --dev
```

### ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¸€è¦§ã®å–å¾—

ãã‚Œã§ã¯æ—©é€Ÿãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸€è¦§ã‚’å–å¾—ã—ãªãŒã‚‰ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æˆå¦ã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸€è¦§ãŒã‚½ãƒ¼ãƒˆã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

:::message
ä»¥é™pipã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨ã‚’å‰æã«ã‚³ãƒžãƒ³ãƒ‰ã‚’è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚
poetryç­‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹äººã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒžãƒãƒ¼ã‚¸ãƒ£ãªã©ã«åˆã‚ã›ã¦é©å®œfixã—ã¦ãã ã•ã„ã€‚
:::

```shell
pip-licenses --order=license
```

### ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ã‚ˆã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯

æ¬¡ã«CIã®ãŸã‚ã«ã€ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ã€‚

ã‚„ã‚Šæ–¹ã¨ã—ã¦ã¯æ¥µã‚ã¦å˜ç´”ã§`--allow-only`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¨±å¯ã—ãŸã„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ ; åŒºåˆ‡ã‚Šã§è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

ä¾‹ãˆã°ã€MIT Licenseã¨BSD Licenseã‚’è¨±å¯ã™ã‚‹å ´åˆä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

```bash
pip-licenses --allow-only="MIT License;BSD License;"
```

## GitHub Actionsã§ã®å®Ÿè¡Œ

ã“ã“ã¾ã§è§£èª¬ã™ã‚Œã°ã€`pip-licenses`ã®ä½¿ã„æ–¹

ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ã‚ˆã£ã¦ä¸€åº¦ç›®ã‚’é€šã—ã¦å•é¡ŒãŒãªã„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«é–¢ã—ã¦ã¯ç›®ã‚’é€šã™å¿…è¦ã¯ãªãã€ãã‚Œä»¥å¤–ã®æœªçŸ¥ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

å¤±æ•—å¾Œã¯å•é¡ŒãŒãªã„ã®ã§ã‚ã‚Œã°ã€è¨±å¯ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

```yml
name: license-check

on:
  push:

jobs:
  license-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v3
        with:
          python-version: "3.9"
      - name: Upgrade pip
        run: |
          pip install --upgrade pip
      - name: Install Poetry
        run: |
          pip install poetry
      - name: Intall Libs
        run: |
          poetry install
      - name: Run Licenses Check
        run: >
          poetry run pip-licenses
          --with-system
          --allow-only="
            MIT License;
            BSD License;
            "
```
